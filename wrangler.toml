name = "grok2api"
main = "src/index.ts"
compatibility_date = "2026-01-28"

# Static assets (admin UI)
assets = { directory = "./app/static", binding = "ASSETS" }

# Hard-pin execution closer to the US to make egress locality more stable.
# Docs: https://developers.cloudflare.com/workers/platform/placement/
[placement]
region = "aws:us-east-1"

[[d1_databases]]
binding = "DB"
database_name = "grok2api"
# 已替换为你的 D1 Database ID
database_id = "0e8bcf47-e1ba-4380-90de-3008bdf906da"
migrations_dir = "migrations"

[[kv_namespaces]]
binding = "KV_CACHE"
# 已替换为你的 KV Namespace ID
id = "96b1183977724c5aa7cc461837872efd"

# Durable Objects migrations history:
[[migrations]]
tag = "do-v1"
new_sqlite_classes = ["AutoRegisterJob"]

[[migrations]]
tag = "do-v2"
deleted_classes = ["AutoRegisterJob"]

[vars]
# Daily reset at local midnight (default: Asia/Shanghai, UTC+8).
CACHE_RESET_TZ_OFFSET_MINUTES = "480"

# Build info
BUILD_SHA = "dev"

# Workers KV has per-value limits; keep <= 25MB.
KV_CACHE_MAX_BYTES = "26214400"

# Batch size for the daily cleanup job.
KV_CLEANUP_BATCH = "200"

[triggers]
# Every day at 00:00 (Asia/Shanghai => 16:00 UTC)
crons = ["0 16 * * *"]
